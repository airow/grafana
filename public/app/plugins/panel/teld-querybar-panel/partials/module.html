<div class="teld-querybar-panel">
  <div>
    <div class="tabbed-view-header">
      <ul class="gf-tabs" ng-show="ctrl.defineQuery">
        <li class="gf-tabs-item" ng-dblclick="ctrl.defineQuery!=ctrl.defineQuery" ng-repeat="target in ctrl.panel.targets">
          <a class="gf-tabs-link" ng-click="ctrl.changeQueryBarTab(target)" ng-class="{active: ctrl.currentTarget.refId === target.refId}">
            {{target.refId}} <i ng-if="target.conf.required" style="color: red;" class="fa fa-asterisk"></i>
          </a>
          <!-- <a class="gf-tabs-link" ng-if="ctrl.currentTarget.refId === target.refId" ng-class="{active: ctrl.currentTarget.refId === target.refId}">
              <i class="fa fa-refresh"></i>
          </a> -->
        </li>
      </ul>
      <h2 class="tabbed-view-title" ng-show="!ctrl.defineQuery">
          <span ng-repeat="target in ctrl.panel.targets">{{target.refId}}:{{target.select}},</span>
      </h2>
      <button class="tabbed-view-close-btn" ng-click="ctrl.defineQuery=!ctrl.defineQuery">
        <i class="fa" ng-class="{true:'fa-remove',false:'fa-remove'}[ctrl.defineQuery||false]"></i>
      </button>
    </div>
    <div class="-tabbed-view-body" ng-show="ctrl.defineQuery">
      <div ng-repeat="target in ctrl.panel.targets" style="margin-top: 2px;" st2yle="border: 1px red solid;border-top: 0px;padding: 10px;" ng-if="ctrl.currentTarget.refId === target.refId">
        <div class="gf-form-inline">
          <div class="gf-form" ng-repeat="dsQueryVariable in target.conf.dsQueryVariables">
            <label class="gf-form-label query-keyword">{{dsQueryVariable.label}}</label>
            <input type="text" class="gf-form-input" ng-model="ctrl.currentTabInfo[target.refId].dsQuery[dsQueryVariable.name].value" spellcheck="false" placeholder="Lucene query">
          </div>
          <div class="gf-form">
            <label class="gf-form-label">
              <a ng-click="ctrl.toggleQuery(target)">
                <i class="fa fa-filter"></i>
              </a>
            </label>
          </div>
        </div>
        <ks-swiper-container wrapper-cls="swiper-wrapper-cls" loop="false" space-between="10" show-nav-buttons="false" on-ready="ctrl.onReadySwiper(swiper)" override-parameters="{mousewheelControl:true,observer: true, observeParents: true}">
          <ks-swiper-slide slider-cls='{{ctrl.getSliderCls(target,$index)}}' ng-repeat="row in ctrl.getQueryResult(target)">
            <div ng-if="row.isNil">
              <div ng-click="ctrl.setQueryBarVariable(target, row)">
                <div class="empty">
                  <p style="font-weight: bold;">无</p>
                </div>
              </div>
            </div>
            <div ng-if="!row.isNil">
              <div ng-click="ctrl.setQueryBarVariable(target, $index, row)" style="background-color: red;">
                <div class="activeflag"><i class="fa fa-check-square-o"></i></div>
                <div class="lt">
                  <p>{{$index+1}}</p>
                </div>
                <div class="rt">
                  <div>
                    <p class="top" ng-if="row.top" ng-style="row.topStyle" ng-class="row.topCls">{{row.top}}</p>
                    <p class="title" ng-style="row.titleStyle" ng-class="row.titleCls">{{row.title || (row.valueTmpl || row.value)}}</p>
                    <p class="bottom" ng-if="row.bottom" ng-style="row.bottomStyle" ng-class="row.bottomCls">{{row.bottom}}</p>
                  </div>
                </div>
              </div>
            </div>
          </ks-swiper-slide>
          <ks-swiper-slide ng-if="ctrl.spin">
            <div>
              <div class="empty">
                <p><i class="fa fa-refresh fa-spin" style="font-size: 24px;"></i></p>
              </div>
            </div>
          </ks-swiper-slide>
        </ks-swiper-container>
          <!-- <div class="myslides">
              <ks-swiper-container autoplay="false" swiper="ctrl.swiper" on-ready="ctrl.onReadySwiper(swiper)">
                  <ks-swiper-slide ng-repeat="s in [1,2,3,4,5,6,7,8,9,10,11,12,13,14]">
                      <img ng-click="ctrl.alert(s);" ng-src="http://api.randomuser.me/portraits/thumb/men/{{s}}.jpg">
                  </ks-swiper-slide>
              </ks-swiper-container>
              <button ng-click="ctrl.next()">Next</button>
          </div> -->
      </div>
    </div>
  </div>
  <div ng-show="ctrl.defineQuery">
      <div class="gf-form-inline">
        <div class="gf-form">
          <label class="gf-form-label query-keyword">过滤条件</label>
        </div>
        <div class="gf-form" ng-repeat="(key,variable) in ctrl.getExprVariables()">
          <!-- <label class="gf-form-label query-keyword">{{key}}</label>
          <label class="gf-form-label">&nbsp;{{variable.current.text}}&nbsp;</label> -->
          <label class="gf-form-label">{{key}}：{{variable.current.text}}</label>
          <!-- [{{ctrl.query()}}] -->
        </div>
        <div class="gf-form">
          <label class="gf-form-label">
            <a ng-click="ctrl.query()">
              <i class="fa fa-search"></i>查询
            </a>
          </label>
        </div>
      </div>
  </div>
</div>
