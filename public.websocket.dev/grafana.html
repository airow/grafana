<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title></title>
  <meta charset="utf-8" />
  <link href="css/common.css" rel="stylesheet" />
  <style>

  </style>
  <script src="lib/jquery-3.2.1.js"></script>
  <script src="lib/socket.js"></script>
  <script>
    //消息推送服务地址
    var url = "rp1.teld.cn/api/WebSocket?user=grafanaCenter";

    //消息推送对象
    var _sk = new socket();
    _sk.init(url, function (mes) {
      dealMessage(mes);
    });

    //接收到消息后的处理
    function dealMessage(mes) {
      console.log(mes);
      var jsonMes = eval("(" + mes + ")");//转换为json对象

      var html = "";
      html += '<div class="message-item">';
      html += jsonMes.sender + ':<br/>';
      try {
        html += JSON.stringify(jsonMes.message);
      }
      catch (e)
      { }
      html += '</div>';

      $("#divMessage").append($(html));
    }

    $(function () {
      //点击发送
      $("#btnSend").unbind("click").bind("click", function () {
        if ($("#txtMessage").val() == "") {
          alert("请输入要发送的内容！");
          return;
        }

        //如果内容为json字符串不用加单引号
        _sk.send($("#divUser").val() + "|'" + $("#txtMessage").val() + "'");
        $("#txtMessage").val("");
      });

      $(".btnSendToGrafana").unbind("click").bind("click", function () {
        var type = $(this).data('type');
        var params = $(this).data('params');

        //params=JSON.parse(params);

        var message = { type: type, params: params };

        message = JSON.stringify(message);

        _sk.send($("#divUser").val() + "|" + message);

        //如果内容为json字符串不用加单引号
        //_sk.send( $( "#divUser" ).html() + "|'" + message + "'" );
      }).each(function () {
        $(this).css({ display: 'block' }).val(JSON.stringify($(this).data('params')));
      });

      $("body").keydown(function (e) {
        if (e.keyCode == 13) {
          $("#btnSend").click();
        }
      });

      //选择用户
      $(".user-item").unbind("click").bind("click", function () {
        if ($("#cbAll").is(':checked')) {
          return false;
        }

        $(".user-item").removeClass("user-select");
        $(this).addClass("user-select");
        $("#divUser").val($(this).html());
      });

      //选择用户
      $("#cbAll").unbind("click").bind("click", function () {
        var _checked = $(this).is(':checked');

        if (!_checked) {
          $(".user-item").eq(0).click();
        }
        else {
          $(".user-item").removeClass("user-select").addClass("user-select");
          $("#divUser").val("all");
        }
      });
    });
  </script>
</head>

<body>
  <div class="content-panel">

    <div class="block-left bolck-operate">
      <div class="block-title">通讯消息</div>
      <div id="divMessage" style='height:100px;'></div>
      <div id="divOperate">
        <!-- <div id="divUser"></div> -->
        <input type="text" id="divUser" value="lefttop" />
        <input type="text" id="txtMessage" />
        <input type="button" id="btnSend" value="发送" />
      </div>
      <br>
      <div>
        <input type="button" class="btnSendToGrafana" data-type="gotoprovince" data-params='{}' value="发送(省)" />
        <input type='button' class='btnSendToGrafana' data-type='gotocity' data-params='{"_$":{"citycode":"3702","cityname":"青岛市"}}'
        />
        <input type='button' class='btnSendToGrafana' data-type='gotostat' data-params='{"_$":{"statid":"da99de50-fef9-4141-91c4-9311921429a8","statcode":"3702120265","statname":"青岛特锐德云平台测试充电站"}}'
        />
		    <input type='button' class='btnSendToGrafana' data-type='gotostat' data-params='{"_$":{"statid":"56fd1640-3e99-418d-9a7a-ff6f4c7e58ab","statcode":"4107020015","statname":"新乡公交新二街充电站"}}'
        />
        <hr>
        <input type="button" class="btnSendToGrafana" data-type="gotoprovince" data-params='{}' value="发送(省)" />
        <input type='button' class='btnSendToGrafana' data-type='gotocity' data-params='{"_$":{"citycode":"11","cityname":"北京市"}}'
        />
        <input type='button' class='btnSendToGrafana' data-type='gotocity' data-params='{"_$":{"citycode":"12","cityname":"天津市"}}'
        />
        <input type='button' class='btnSendToGrafana' data-type='gotocity' data-params='{"_$":{"citycode":"3702","cityname":"青岛市"}}'
        />
        <input type='button' class='btnSendToGrafana' data-type='gotostat' data-params='{"_$":{"statid":"电站id","statname":"美田"}}'
        />
        <input type='button' class='btnSendToGrafana' data-type='gotostat' data-params='{"_$":{"statid":"电站id","statname":"美地"}}'
        />
        <input type='button' class='btnSendToGrafana' data-type='gotostat' data-params='{"_$":{"statid":"3701050004","statcode":"3701050004","statname":"青岛特锐德云平台测试充电站"}}'
        />
        <input type='button' class='btnSendToGrafana' data-type='gotostat' data-params='{"_$":{"statid":"da99de50-fef9-4141-91c4-9311921429a8","statcode":"3702120265","statname":"青岛特锐德云平台测试充电站"}}'
        />
        <hr>
        <input type='button' class='btnSendToGrafana' data-type='gotodashboard' data-params='{"dashboard":"dashboard://db/00-wsp","var":{"custon":"123"}}'
        />
        <input type='button' class='btnSendToGrafana' data-type='gotodashboard' data-params='{"dashboard":"dashboard://db/00-wsp","var":{"custon":"gogogo"}}'
        />
        <input type='button' class='btnSendToGrafana' data-type='gotodashboard' data-params='{"dashboard":"dashboard://db/00-wsp","qs":{"qs":"gogogo"},"var":{"custon":"cccc"}}'
        />
        <input type='button' class='btnSendToGrafana' data-type='gotodashboard' data-params='{"dashboard":"dashboard://db/00-wsp","qs":{"qs":"gogogo"},"var":{"custon":"cccc"},"_$":{"custon22":""}}'
        />
        <input type='button' class='btnSendToGrafana' data-type='gotodashboard' data-params='{"dashboard":"dashboard://db/00-wsp","qs":{"qs":"gogogo"},"var":{"custon":"cccc"},"_$":{"custon22":"teld"}}'
        />
        <input type='button' class='btnSendToGrafana' data-type='gotodashboard' data-params='{"dashboard":"dashboard://db/001"}'
          value='dashboard://db/001' />
      </div>
    </div>

    <div class="block-left bolck-userlist">
      <div class="block-title">
        用户列表
        <div class="check-all"><input type="checkbox" id="cbAll" /></div>
      </div>
      <div class="user-item user-select">lefttop</div>
      <div class="user-item">leftbottom</div>
      <div class="user-item">righttop</div>
      <div class="user-item">rightbottom</div>
    </div>

    <div class="block-left bolck-userlist" style="margin-top: 50px;">
      <div class="block-title">
        说明
      </div>
      <pre style="">

         演示地址：<a target="_blank" href="http://t-bj-bdpapp.chinacloudapp.cn:4330">http://t-bj-bdpapp.chinacloudapp.cn:4330</a>
        使用 lefttop、leftbottom、righttop、rightbottm 登陆，密码与用户名一直

         type:'gotoprovince | gotocity | gotostat'

            [gotoprovince] 省视图
            params:{}

            [gotocity] 城市视图
            params: {"_$":{"citycode":"12","cityname":"天津市"}}

            [gotostat] 电站视图
            params: {"_$":{"statid":"电站id","statname":"美田"}

            _$后的对象为传递的阐述
      </pre>
    </div>

  </div>
</body>

</html>
