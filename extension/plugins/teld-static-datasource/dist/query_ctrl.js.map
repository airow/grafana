{"version":3,"sources":["../src/query_ctrl.js"],"names":["QueryCtrl","_","GenericDatasourceQueryCtrl","$scope","$injector","scope","target","type","panel","table","columns","rows","timeserie","getTarget","tsCol","name","undefined","find","unshift","push","size","variableArray","index","newIndex","move","variable","indexOf","splice","query","datasource","metricFindQuery","rawQuery","panelCtrl","refresh","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,e,kBAAAA,S;;AAEFC,O;;;;;;;;;;;;;;;;;;;;;4CAEMC,0B;;;AAEX,4CAAYC,MAAZ,EAAoBC,SAApB,EAA+B;AAAA;;AAAA,8JACvBD,MADuB,EACfC,SADe;;AAG7B,gBAAKC,KAAL,GAAaF,MAAb;AACA,gBAAKG,MAAL,CAAYA,MAAZ,GAAqB,MAAKA,MAAL,CAAYA,MAAZ,IAAsB,eAA3C;AACA,gBAAKA,MAAL,CAAYC,IAAZ,GAAmB,MAAKD,MAAL,CAAYC,IAAZ,IAAoB,MAAKC,KAAL,CAAWD,IAAX,KAAoB,qBAAxC,GAAgE,OAAhE,GAA0E,WAA7F;;AAEA,gBAAKD,MAAL,CAAYG,KAAZ,GAAoB,MAAKH,MAAL,CAAYG,KAAZ,IAAqB,EAAEC,SAAS,EAAX,EAAeC,MAAM,EAArB,EAAzC;AACA,gBAAKL,MAAL,CAAYM,SAAZ,GAAwB,MAAKN,MAAL,CAAYM,SAAZ,IAAyB,EAAEF,SAAS,EAAX,EAAeC,MAAM,EAArB,EAAjD;AAR6B;AAS9B;;;;sCAEW;AACV,mBAAO,KAAKL,MAAL,CAAY,KAAKA,MAAL,CAAYC,IAAxB,CAAP;AACD;;;qCAEUA,I,EAAM;AACf,gBAAID,SAAS,KAAKO,SAAL,EAAb;AACA,gBAAIH,UAAUJ,OAAOI,OAArB;AACA,gBAAI,KAAKJ,MAAL,CAAYC,IAAZ,KAAqB,WAAzB,EAAsC;AACpC,kBAAIO,QAAQ,EAAEC,MAAM,UAAR,EAAZ;AACA,kBAAIC,cAAcf,EAAEgB,IAAF,CAAOP,OAAP,EAAgBI,KAAhB,CAAlB,EAA0C;AACxCJ,wBAAQQ,OAAR,CAAgBJ,KAAhB;AACD;AACF;AACDJ,oBAAQS,IAAR,CAAa,EAAEJ,MAAM,EAAR,EAAYR,MAAMA,IAAlB,EAAb;AACA,gBAAIN,EAAEmB,IAAF,CAAOd,OAAOK,IAAd,MAAwB,CAA5B,EAA+B;AAC7BL,qBAAOK,IAAP,CAAYQ,IAAZ,CAAiB,EAAjB;AACD;AACF;;;+BAEIE,a,EAAeC,K,EAAOC,Q,EAAU;AACnCtB,cAAEuB,IAAF,CAAOH,aAAP,EAAsBC,KAAtB,EAA6BC,QAA7B;AACD;;;iCAEMF,a,EAAeI,Q,EAAU;AAC9B,gBAAIH,QAAQrB,EAAEyB,OAAF,CAAUL,aAAV,EAAyBI,QAAzB,CAAZ;AACAJ,0BAAcM,MAAd,CAAqBL,KAArB,EAA4B,CAA5B;AACD;;;mCAEQ,CAER;;;qCAEUM,K,EAAO;AAChB,mBAAO,KAAKC,UAAL,CAAgBC,eAAhB,CAAgCF,SAAS,EAAzC,CAAP;AACD;;;6CAEkB;AACjB,iBAAKtB,MAAL,CAAYyB,QAAZ,GAAuB,CAAC,KAAKzB,MAAL,CAAYyB,QAApC;AACD;;;6CAEkB;AACjB,iBAAKC,SAAL,CAAeC,OAAf,GADiB,CACS;AAC3B;;;;QAvD6CjC,S;;;;AA0DhDE,iCAA2BgC,WAA3B,GAAyC,4BAAzC","file":"query_ctrl.js","sourcesContent":["import { QueryCtrl } from 'app/plugins/sdk';\r\nimport './css/query-editor.css!';\r\nimport _ from 'lodash';\r\n\r\nexport class GenericDatasourceQueryCtrl extends QueryCtrl {\r\n\r\n  constructor($scope, $injector) {\r\n    super($scope, $injector);\r\n\r\n    this.scope = $scope;\r\n    this.target.target = this.target.target || 'select metric';\r\n    this.target.type = this.target.type || this.panel.type === \"teld-querybar-panel\" ? 'table' : 'timeserie';\r\n\r\n    this.target.table = this.target.table || { columns: [], rows: [] };\r\n    this.target.timeserie = this.target.timeserie || { columns: [], rows: [] };\r\n  }\r\n\r\n  getTarget() {\r\n    return this.target[this.target.type];\r\n  }\r\n\r\n  addColumns(type) {\r\n    var target = this.getTarget();\r\n    var columns = target.columns;\r\n    if (this.target.type === 'timeserie') {\r\n      var tsCol = { name: \"time_sec\" };\r\n      if (undefined === _.find(columns, tsCol)) {\r\n        columns.unshift(tsCol);\r\n      }\r\n    }\r\n    columns.push({ name: \"\", type: type });\r\n    if (_.size(target.rows) === 0) {\r\n      target.rows.push({});\r\n    }\r\n  }\r\n\r\n  move(variableArray, index, newIndex) {\r\n    _.move(variableArray, index, newIndex);\r\n  }\r\n\r\n  remove(variableArray, variable) {\r\n    var index = _.indexOf(variableArray, variable);\r\n    variableArray.splice(index, 1);\r\n  }\r\n\r\n  addRow() {\r\n\r\n  }\r\n\r\n  getOptions(query) {\r\n    return this.datasource.metricFindQuery(query || '');\r\n  }\r\n\r\n  toggleEditorMode() {\r\n    this.target.rawQuery = !this.target.rawQuery;\r\n  }\r\n\r\n  onChangeInternal() {\r\n    this.panelCtrl.refresh(); // Asks the panel to refresh data.\r\n  }\r\n}\r\n\r\nGenericDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\r\n\r\n"]}